# 圖片裁切工具

這是一個使用原生 JavaScript 和 HTML `<canvas>` 元素所建立的前端圖片裁切工具。它允許使用者上傳圖片、選取裁切範圍、旋轉圖片，並將裁切資訊以 JSON 物件的形式匯出。它的設計使其可以輕易地整合到 Vue 3 或 React 等現代化的網頁框架中。

本專案由 Gemini 協助開發。

## 主要功能

- **圖片載入**：從使用者的本機檔案系統載入圖片。
- **固定畫布**：在一個固定的 400x400 像素畫布上進行操作，提供一致的使用者體驗。
- **圖片適應與置中 (Letterboxing)**：圖片會被自動縮放以符合畫布大小並置中顯示，同時保持其原始的長寬比。
- **互動式裁切框**：
    - **建立**：在圖片上點擊並拖曳以建立新的裁切框。
    - **拖曳**：將整個裁切框移動到新的位置。
    - **縮放**：透過拖曳裁切框的控制點來調整其大小。
- **長寬比控制**：
    - **固定比例**：可強制設定一個特定的長寬比（例如 1:1 的正方形或 16:9），在建立和縮放裁切框時將會嚴格遵守此比例。
    - **自由比例**：將長寬比設定為 `null`，即可使用八個方向的控制點進行任意比例的自由裁切。
- **圖片旋轉**：將圖片和裁切框以順時針 90 度為單位進行同步旋轉。
- **邊界限制**：即使在旋轉後，裁切框也始終被限制在圖片的可見範圍內。
- **跨裝置支援**：完整支援**滑鼠**與**觸控**事件，確保在桌上型電腦和行動裝置上都能流暢操作。
- **JSON 輸出**：產生一個 JSON 物件，其中包含原始圖片的尺寸以及精確的裁切資訊（x、y、寬度、高度、旋轉角度），可發送至後端進行處理。
- **PHP 後端範例**：專案中包含一個 `index.php` 範例檔案，展示了如何接收 JSON 資料並產生對應的 ImageMagick 指令。

## 如何使用

### 前端

1.  在任何現代的網頁瀏覽器中開啟 `index.html` 檔案。
2.  點擊 **"Choose File"** 按鈕來載入一張圖片。
3.  在圖片上點擊並拖曳以建立一個裁切框。
4.  點擊並拖曳裁切框本身或其控制點來調整裁切範圍。
5.  點擊 **"Rotate 90°"** 按鈕來旋轉圖片。
6.  點擊 **"Crop"** 按鈕來產生 JSON 輸出。

### 後端 (用於測試)

專案中包含一個 `index.php` 範例，以展示完整的工作流程。若要進行測試：

1.  請確保您已安裝 PHP。
2.  在您的終端機中，切換到專案目錄。
3.  啟動內建的 PHP 伺服器：
    ```bash
    php -S localhost:8000
    ```
4.  在瀏覽器中開啟 `http://localhost:8000`。
5.  現在，當您點擊「Crop」按鈕時，資料將會被發送到 PHP 伺服器，而伺服器的回應（包含產生的 ImageMagick 指令）將會顯示在畫面上。

## 開發者指南

核心邏輯被封裝在 `cropper.js` 的 `ImageCropper` 類別中。

### 實例化

若要使用此裁切工具，請建立一個 `ImageCropper` 類別的實例，並傳入您的 canvas 元素的 ID 以及一個選項物件。

```javascript
// 在您的主要腳本檔案中
document.addEventListener('DOMContentLoaded', () => {
    const cropper = new ImageCropper('imageCanvas', {
        // 選項設定於此
        aspectRatio: 16 / 9 // 範例：16:9 的長寬比
    });

    // 設定您的事件監聽器來呼叫 cropper 的方法
    const imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (event) => {
            cropper.loadImage(event.target.result);
        }
        reader.readAsDataURL(e.target.files[0]);
    });
});
```

### 選項

您可以在建構函式中傳入以下選項：

| 選項          | 類型   | 預設值 | 描述                                                                                              |
|---------------|--------|---------|---------------------------------------------------------------------------------------------------| 
| `width`       | Number | `400`   | 畫布的寬度。                                                                                      |
| `height`      | Number | `400`   | 畫布的高度。                                                                                      |
| `aspectRatio` | Number | `null`  | 裁切框的目標長寬比（例如 `1` 代表正方形，`16/9`）。設定為 `null` 則為自由比例。 |

## 檔案結構

- `README.md`: 本檔案。
- `DEBUG.md`: 偵錯與修復過程的日誌。
- `REQUIREMENTS.md`: 專案需求文件。
- `index.html`: 包含畫布和控制項的主要 HTML 檔案。
- `style.css`: 應用程式的樣式表。
- `cropper.js`: 包含 `ImageCropper` 類別及所有相關邏輯的核心 JavaScript 檔案。
- `index.php`: 用於處理裁切資料的後端範例腳本。